<?phpif(!class_exists("Utilisateur")){		class Utilisateur	{				//tous les attributs d'un utilisateur, operateur ou administrateur				protected $_nom;						//varchar 50		protected $_prenom;					//varchar 50		protected $_telephone;				//varchar 10		protected $_email;					//varchar 255		protected $_villeFacturation;			//varchar 80		protected $_adresseFacturation;		//varchar 80		protected $_codePostalFacturation;	//varchar 5		protected $_villeExpedition;			//varchar 80		protected $_adresseExpedition;		//varchar 80		protected $_codePostalExpedition;		//varchar 5		protected $_permissions;				// int 1		private $_bdd;				public function __construct()		{			$this->_bdd=new Bdd;		}				public function setMail($email)	// recupere le mail de l'utilisateur utilisé apres l'initialisation		{						$this->_email=$email;					}				public function recuData()		{						$connexionBdd=$this->_bdd->openBDD();	//	ouverture de la base de données						$sql="select * from clients where email='$this->_email'";						$result = $connexionBdd->query($sql);	// execution de la requete												if ($result->num_rows > 0)			{		// verification que le compte existe								// output data of each row								while($row = $result->fetch_assoc())				{			// recuperation de tous les parametres										$this->_email = $row["email"];										$this->_prenom = $row["prenom"];										$this->_nom = $row["nom"];										$this->_password = $row["password"];										$this->_adresseExpedition = $row["rue_expedition"];										$this->_villeExpedition = $row["ville_expedition"];										$this->_codePostalExpedition = $row["code_postal_expedition"];										$this->_adresseFacturation = $row["rue_facturation"];										$this->_villeFacturation = $row["ville_facturation"];										$this->_codePostalFacturation = $row["code_postal_facturation"];										$this->_telephone=$row["telephone"];										$this->_permissions = $row["permissions"];									}			}			$this->$this->_bdd->CloseBDD();DD();		//fermeture de la base de données		}				public function modifierAvatar()		// essenciellement de l'affichage avec les valeurs du compte		{			global $login_session;			$avatar = "";						$connect =$this->_bdd->openBDD();			$sql="SELECT avatar FROM clients WHERE email='$login_session'";			$result = $connect->query($sql);						while ($row = $result->fetch_assoc()) {				$avatar = $row["avatar"];			}						return ('<div class="demo-card-wide mdl-card mdl-shadow--2dp">	<div class="mdl-card__title mdl-card-profil__background animated slideInDown">	<h2 class="mdl-card__title-text">'.$this->_prenom.' '.$this->_nom.'</h2>	</div>							<div class="mdl-card__supporting-text card-background">							<form action="index.php?d=utilisateur&a=avatar" method="post" enctype="multipart/form-data">							<div id="alert" >		</div>							<h5 class="animated fadeIn">Modifiez votre image de profil</h5>							<div class="content-grid mdl-grid">			<div class="mdl-cell--6-col animated fadeIn">				<h6>Changement de votre image de profil</h6>				<br/>				<input name="fileToUpload" type="file" style="display:none" id="upload-image"></input>					<div id="upload" class="drop-area">					   Cliquez-ici afin de pouvoir sélectionner votre nouvelle image de profil					</div>								<div id="thumbnail"></div>									<br/><br/>				<button name="submit" type="submit" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored">					Changer votre avatar				</button>				</form>			</div>			<div class="mdl-cell--6-col animated fadeIn">				<h6>Aperçu de votre image de profil actuelle</h6>				<br/>				<img class="avatar-preview" src="vue/images/profil/'.$avatar.'.png" width="200px" height="200px"></img>			</div>	</div></div>');}				public function modifierProfil()		// essenciellement de l'affichage avec les valeurs du compte				{			return ('<div class="demo-card-wide mdl-card mdl-shadow--2dp">	<div class="mdl-card__title mdl-card-profil__background animated slideInDown">	<h2 class="mdl-card__title-text">'.$this->_prenom.' '.$this->_nom.'</h2>	</div>							<div class="mdl-card__supporting-text card-background">							<form action="index.php?d=utilisateur&a=profil" method="post">							<div id="alert" >		</div>							<h5 class="animated fadeIn">Modifiez vos informations personnelles</h5>							<div class="content-grid mdl-grid">			<div class="mdl-cell animated fadeIn">				<h6>Identifiants de connexion</h6>									  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">					<input name="email" class="mdl-textfield__input" id="email" type="text" value="'.$this->_email.'" readonly>					<label class="mdl-textfield__label" for="sample3">Adresse E-mail</label>					<div class="mdl-tooltip" data-mdl-for="email">					Pour changer votre email, veuillez contacter un administrateur.					</div>				  </div>								  <br/>									  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">					<input name="password" id="password" class="mdl-textfield__input" type="password">					<label class="mdl-textfield__label" for="sample3">Mot de passe</label>				  </div>									  <br/>									  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">					<input name="verification" id="password_check" class="mdl-textfield__input" type="password">					<label class="mdl-textfield__label" for="sample3">Confirmation du mot de passe</label>				  </div>													</div>								<div class="mdl-cell animated fadeIn">				<h6>Données personnelles</h6>									  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">					<input name="nom" class="mdl-textfield__input" id="nom" type="text" value="'.$this->_nom.'" required="required">					<label class="mdl-textfield__label" for="sample3">Nom</label>				  </div>  				  				  <br/>									  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">					<input name="prenom" class="mdl-textfield__input" id="prenom" type="text" value="'.$this->_prenom.'" required="required">					<label class="mdl-textfield__label" for="sample3">Prénom</label>				  </div>									  <br/>				  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">					<input name="telephone" class="mdl-textfield__input" id="telephone" type="text" value="'.$this->_telephone.'" required="required">					<label class="mdl-textfield__label" for="sample3">Téléphone</label>				  </div>								</div>								<div class="mdl-cell animated slideInRight">				<br/><br/><br/>				<img src="vue/images/profil_account.png" height="200px" width="200px">			</div>								<div class="mdl-cell animated fadeIn">				<h6>Adresse de facturation</h6>									  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">					<input name="adresseFacturation" class="mdl-textfield__input" id="adresseFacturation" type="text" value="'.$this->_adresseFacturation.'" required="required">					<label class="mdl-textfield__label" for="sample3">Adresse</label>				  </div>				  <br/>									  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">					<input name="villeFacturation" class="mdl-textfield__input" id="villeFacturation" type="text" value="'.$this->_villeFacturation.'" required="required">					<label class="mdl-textfield__label" for="sample3">Ville</label>				  </div>				  <br/>									  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">					<input name="codePostalFacturation" class="mdl-textfield__input" id="codePostalFacturation" type="text" value="'.$this->_codePostalFacturation.'" required="required">					<label class="mdl-textfield__label" for="sample3">Code postal</label>				  </div>			</div>								<div class="mdl-cell animated fadeIn">				<h6>Adresse d\'expédition</h6>									  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">					<input name="adresseExpedition" class="mdl-textfield__input" id="adresseExpedition" type="text" value="'.$this->_adresseExpedition.'" required="required">					<label class="mdl-textfield__label" for="sample3">Adresse</label>				  </div>				  <br/>									  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">					<input name="villeExpedition" class="mdl-textfield__input" id="villeExpedition" type="text" value="'.$this->_villeExpedition.'" required="required">					<label class="mdl-textfield__label" for="sample3">Ville</label>				  </div>				  <br/>									  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">					<input name="codePostalExpedition" class="mdl-textfield__input" id="codePostalExpedition" type="text" value="'.$this->_codePostalExpedition.'" required="required">					<label class="mdl-textfield__label" for="sample3">Code postal</label>				  </div>			</div>								<div class="mdl-cell animated slideInRight">				<br/><br/><br/>				<img src="vue/images/profil_shipping.png" height="200px" width="200px" style="margin-bottom: 50px;">			</div>								<div class="mdl-card__actions mdl-card--border card-background2 animated slideInUp">			<center>				<button  type="submit" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">					Valider les modifications apportées				</button>			</center>			</form>			<div/>	</div></div>');						// utilisation de modele/formulaires/update.php en POST pour valider les changements					}				public function validerModifierProfil()		{			$connect =$this->_bdd->openBDD();						$email=$_POST["email"];						$new_password=$_POST["password"];						$verification=$_POST["verification"];						$rue_expedition=$_POST["adresseExpedition"];						$code_postal_expedition=$_POST["codePostalExpedition"];						$ville_expedition=$_POST["villeExpedition"];						$rue_facturation=$_POST["adresseFacturation"];						$code_postal_facturation=$_POST["codePostalFacturation"];						$ville_facturation=$_POST["villeFacturation"];						$nom=$_POST["nom"];						$prenom=$_POST["prenom"];						$telephone=$_POST["telephone"];						if(($new_password==$verification)&&($new_password!=""))			{				$new_password=sha1($verification);								$sql="UPDATE clients SET password='$new_password', nom='$nom',prenom='$prenom',telephone='$telephone', ville_expedition='$ville_expedition', rue_expedition='$rue_expedition',code_postal_expedition='$code_postal_expedition', ville_facturation='$ville_facturation', rue_facturation='$rue_facturation', code_postal_facturation='$code_postal_facturation' WHERE  email='$email'";							}			else			{				$sql="UPDATE clients SET  nom='$nom',prenom='$prenom',telephone='$telephone',ville_expedition='$ville_expedition', rue_expedition='$rue_expedition', code_postal_expedition='$code_postal_expedition', ville_facturation='$ville_facturation', rue_facturation='$rue_facturation', code_postal_facturation='$code_postal_facturation'  WHERE  email='$email'";			}			$connect->query($sql);						$this->_bdd->CloseBDD();						echo "<script>alert('Modifications correctement apportées à votre profil.'); location.href = 'index.php?d=utilisateur&a=profil';</script>";		}						public function validerModifierAvatar()		{			global $login_session;						$avatar = str_replace(".", "_",$login_session);			$target_dir = "vue/images/profil/";			$target_file = $target_dir . basename($avatar).".png";			$uploadOk = 1;			$imageFileType = pathinfo($target_file,PATHINFO_EXTENSION);			// Check if image file is a actual image or fake image			if(isset($_POST["submit"])) {				$check = getimagesize($_FILES["fileToUpload"]["tmp_name"]);				if($check !== false) {					$uploadOk = 1;				} else {					echo '						<script>							alert("Erreur : Votre fichier n\'est pas une image. Veuillez sélectionner une image puis réessayer.");							location.href = "index.php?d=utilisateur&a=avatar";						</script>';					$uploadOk = 0;				}			}			// Check file size			if ($_FILES["fileToUpload"]["size"] > 500000) {				echo '					<script>						alert("Erreur : Votre image est trop volumineuse. Elle doit faire au maximum 5 mo.");						location.href = "index.php?d=utilisateur&a=avatar";					</script>';				$uploadOk = 0;			}			// Allow certain file formats			if($imageFileType != "jpg" && $imageFileType != "png" && $imageFileType != "jpeg"					&& $imageFileType != "gif" ) {						echo '							<script>								alert("Erreur : Votre image doit être au format : jpeg, jpg, png ou gif seulement. Changez de format puis réessayer.");								location.href = "index.php?d=utilisateur&a=avatar";							</script>';						$uploadOk = 0;					}					// Check if $uploadOk is set to 0 by an error					if ($uploadOk == 0) {						echo '							<script>								alert("Erreur : Une erreur s\'est produite durant l\'hébergement de votre image.");								location.href = "index.php?d=utilisateur&a=avatar";							</script>';						// if everything is ok, try to upload file					} else {						if (move_uploaded_file($_FILES["fileToUpload"]["tmp_name"], $target_file)) {							$connect = $this->_bdd->openBDD();							$sql="UPDATE clients SET avatar='$avatar' WHERE  email='$login_session'";							$connect->query($sql);							$this->_bdd->CloseBDD();							echo '								<script>									alert("Succès : Votre image de profil a correctement été modifiée.");									location.href = "index.php?d=utilisateur&a=avatar";								</script>';						} else {							echo '								<script>									alert("Erreur : Une erreur s\'est produite durant l\'hébergement de votre image.");									location.href = "index.php?d=utilisateur&a=avatar";								</script>';						}					}		}						public function visualiserControle() // COMING SOON		{																													}						public function deconnexion()		{			// On détruit toutes les sessions actuellement actives			if(session_destroy())			{				header("Location: index.php"); // on redirige vers une page			}					}			}	}?>