<?phpif(!class_exists("Administrateur")){		class Administrateur extends Operateur		{				public function __construct()				{								}				public function validerControl()		// a venir				{											}				public function menuAdministration()	// fonction qui affiche le menu/pannel des annonces				{						// chaque <div  class="mdl-cell"> est un item du menu						return ('<div class="demo-card-wide mdl-card mdl-shadow--2dp">										<div class="mdl-card__title mdl-card-administration__background animated slideInDown">											<h2 class="mdl-card__title-text">Administration</h2>										</div>										<div class="mdl-card__supporting-text card-background">																					<h5 class="animated fadeIn">Sélectionnez une action</h5>																					<br />																					<div class="content-grid mdl-grid hover01 column animated zoomInDown">												<div class="mdl-cell" style="margin-left: 25px; margin-bottom: 50px;">													<figure><a href="index.php?d=administrateur&a=gerer_utilisateurs"><img width="250" height="200" src="vue/images/utilisateurs.png" /></a></figure>													<span>Gérer les utilisateurs</span>												</div>																						<div class="mdl-cell"  style="margin-bottom: 50px;">													<figure><a href="index.php?d=administrateur&a=gerer_tarifs"><img width="250" height="200" src="vue/images/tarifs.png" /></a></figure>													<span style="margin-left: 12%;">Gérer les tarifs</span>												</div>																</div>										</div>							');					}				public function gererUtilisateurs()	// affiche la page avec dans $déroulant le select des clients				{			$connect = $this->_bdd->openBDD();	// ouverture de la BDD avec l'objet créé dans session.php qui est accéssible dans le noyau						$query="SELECT * FROM `clients`";						$result = mysqli_query($connect ,$query);		// recuperation de tous les clients									$deroulant = "<option value='-2'> </option>											<option value='-1'>Choisir un client</option>";			// tampon pour l'affichage						while($row = mysqli_fetch_array($result))			{				$deroulant = $deroulant."<option value=$row[0]>$row[1]</option>";		// ajout de tous les clients avec $row[0]=id et $row[1] leur email				$permissions = $row["permissions"];			}												$this->_bdd->CloseBDD();		// fermeture de la connexion à la BDD									return( '									<div class="demo-card-wide mdl-card mdl-shadow--2dp">									<div class="mdl-card__title mdl-card-administration__background animated slideInDown">									<h2 class="mdl-card__title-text">Panel administrateur</h2>									</div>									<div class="mdl-card__supporting-text card-background">																			<h5 class="animated fadeIn">Modifier les informations liées aux clients</h5>									<br />									<form action="index.php?d=administrateur&a=delete" method="post">									<select id="client" class="nice-select" name="client" onchange="affich()">										<?php											echo('.$deroulant.');										?>										</select>										<a id="ajout_compte" class="mdl-button mdl-js-button mdl-button--primary" href="#ajout_client">						Ajouter un compte					</a>										<button id="supprimer" type="submit" style="color: #F44336; margin-left: -170px;" class="mdl-button mdl-js-button mdl-button--accent">						Supprimer le compte					</button>														<br /><br />								</form>								<br />								<div id="affichage">										<div id="options-admin" class="mdl-grid animated bounceInLeft">						<div class="mdl-cell mdl-cell--2-col graybox">							<div class="demo-card-square mdl-card mdl-shadow--2dp">							  <div class="titre mdl-card__title mdl-card__title-identifiants mdl-card--expand">								<h2 class="mdl-card__title-text">Identifiants</h2>							  </div>							  <div class="mdl-card__supporting-text">									<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">										<input name="email_adm" class="mdl-textfield__input" type="text" value=" "  id="email_adm" >										<label class="mdl-textfield__label" for="sample3" id="1">Email</label>									</div>									<br />							  </div>							  <div class="mdl-card__actions mdl-card--border card-background2">							  <label id="label_activation_adm" for="activation_adm" class="mdl-switch mdl-js-switch mdl-js-ripple-effect">								  <input type="checkbox" name="activation" id="activation_adm" class="mdl-switch__input" value="1">								  <span class="mdl-switch__label">Activer le compte</span>							  </label>								<br />							  </div>							</div>						</div>													<div class="mdl-cell mdl-cell--1-col graybox">							<!-- Contenu vide -->						</div>													<div class="mdl-cell mdl-cell--2-col graybox">							<div class="demo-card-square mdl-card mdl-shadow--2dp">							  <div class="titre mdl-card__title mdl-card__title-identite mdl-card--expand">								<h2 class="mdl-card__title-text">Identité</h2>							  </div>							  <div class="mdl-card__supporting-text">									<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">										<input name="nom" class="mdl-textfield__input" type="text" value=" " id="nom_adm">										<label class="mdl-textfield__label" for="sample3" id="2">Nom</label>									</div>									<br />									<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">										<input  name="prenom" class="mdl-textfield__input" type="text" value=" " id="prenom_adm">										<label class="mdl-textfield__label" for="sample3" id="3">Prénom</label>									</div>									<br />									<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">										<input name="telephone" class="mdl-textfield__input" type="text" value=" " id="telephone_adm">										<label class="mdl-textfield__label" for="sample3" id="4">Téléphone</label>									</div>							  </div>							  <div class="mdl-card__actions mdl-card--border card-background2" id="permissions_adm">							  <label id="label_operateur_adm" for="operateur_adm" class="mdl-switch mdl-js-switch mdl-js-ripple-effect">								  <input type="checkbox" name="operateur" id="operateur_adm" class="mdl-switch__input" value="2">								  <span class="mdl-switch__label">Opérateur</span>							  </label>								<br />							  </div>							</div>						</div>						<div class="mdl-cell mdl-cell--1-col graybox">							<!-- Contenu vide -->						</div>						<div class="mdl-cell mdl-cell--2-col graybox">							<div class="demo-card-square2 mdl-card mdl-shadow--2dp">							  <div class="titre mdl-card__title mdl-card__title-expedition mdl-card--expand">								<h2 class="mdl-card__title-text">Adresse expédition</h2>							  </div>							  <div class="mdl-card__supporting-text">									<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">										<input name="rue_exp" class="mdl-textfield__input" type="text" value=" " id="rue_exp_adm">										<label class="mdl-textfield__label" for="sample3" id="5">Rue expédition</label>									</div>									<br />									<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">										<input name="code_exp" class="mdl-textfield__input" type="text" value=" " id="code_exp_adm">										<label class="mdl-textfield__label" for="sample3" id="6">Code postal expédition</label>									</div>									<br />									<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">										<input name="ville_exp" class="mdl-textfield__input" type="text" value=" " id="ville_exp_adm">										<label class="mdl-textfield__label" for="sample3" id="7">Ville expédition</label>									</div>									<div class="espace"></div>								</div>							</div>						</div>													<div class="mdl-cell mdl-cell--1-col graybox">							<!-- Contenu vide -->						</div>						<div class="mdl-cell mdl-cell--2-col graybox">							<div class="demo-card-square2 mdl-card mdl-shadow--2dp">							  <div class="titre mdl-card__title mdl-card__title-facturation-lg mdl-card--expand">								<h2 class="mdl-card__title-text">Adresse facturation</h2>							  </div>							  <div class="mdl-card__supporting-text">									<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">										<input name="rue_fac" class="mdl-textfield__input" type="text" value=" " id="rue_fact_adm">										<label class="mdl-textfield__label" for="sample3" id="8">Rue facturation</label>									</div>									<br />									<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">										<input  name="code_fac" class="mdl-textfield__input" type="text" value=" " id="code_fact_adm">										<label class="mdl-textfield__label" for="sample3" id="9">Code postal facturation</label>									</div>									<br />									<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">										<input name="ville_fac" class="mdl-textfield__input" type="text" value=" " id="ville_fact_adm">										<label class="mdl-textfield__label" for="sample3" id="10">Ville facturation</label>									</div>																		<div class="espace"></div>								</div>							</div>																				</div>						</div>				</div>									<div id="ajout_client" class="overlay">						<div class="popup_nouveau_client">							<h2>Création d\'un nouveau compte</h2>							<a class="close" href="#">&times;</a>							<form action="index.php?d=administrateur&a=nouveau_client" method="post">								<div class="content">									<div class="mdl-grid">										<div class="mdl-cell mdl-cell--12-col graybox">											<h7 style="font-size: 18px;">Informations liées au compte</h7>										</div>											<div class="mdl-cell mdl-cell--4-col graybox">											  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">												<input class="mdl-textfield__input" type="email" id="email" name="email" required="required">												<label class="mdl-textfield__label" for="email">Email</label>											  </div>											  <div class="mdl-cell mdl-cell--11-col graybox">												<p>Le mot de passe du compte est généré automatiquement et envoyé par email à l\'utilisateur.</p>											  </div>											</div>											<div class="mdl-cell mdl-cell--4-col graybox">											  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">												<input class="mdl-textfield__input" type="text" id="nom" name="nom" required="required">												<label class="mdl-textfield__label" for="nom">Nom</label>											  </div>											  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">												<input class="mdl-textfield__input" type="text" id="prenom" name="prenom" required="required">												<label class="mdl-textfield__label" for="prenom">Prénom</label>											  </div>											  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">												<input class="mdl-textfield__input" type="text" id="telephone" name="telephone" maxlength="10" required="required">												<label class="mdl-textfield__label" for="telephone">Téléphone</label>											  </div>											</div>											<div class="mdl-cell mdl-cell--4-col graybox">											  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">												<input class="mdl-textfield__input" type="text" id="adresse" name="adresse" required="required">												<label class="mdl-textfield__label" for="adresse">Adresse</label>											  </div>											  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">												<input class="mdl-textfield__input" type="text" id="code_postal" name="code_postal" maxlength="5" required="required"">												<label class="mdl-textfield__label" for="code_postal">Code postal</label>											  </div>											  <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">												<input class="mdl-textfield__input" type="text" id="ville" name="ville" required="required">												<label class="mdl-textfield__label" for="ville">Ville</label>											  </div>											</div>											<div class="mdl-cell mdl-cell--12-col graybox">											  <h7 style="font-size: 18px;">Permissions</h7>											</div>											<div class="mdl-cell mdl-cell--12-col graybox">											  <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="permissions">												<input type="checkbox" id="permissions" class="mdl-switch__input" name="permissions" value="1">												<span class="mdl-switch__label">Opérateur</span>											  </label>											</div>										</div>									</div>																		<br />									<hr />																		<button type="submit" class="mdl-button mdl-js-button mdl-button--primary" style="text-decoration:none; color:rgb(96,125,139)">CRÉER LE COMPTE</button>													</div>						</form>					</div>					<div class="espace"></div>			</div>														<div id="validation" class="mdl-card__actions mdl-card--border card-background2 animated slideInUp">								<center>													<button onClick="update()" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">								Valider les modifications apportées								</button>																			</center>							</div>							<div class="mdl-card__menu">							</div>								<script>affich();</script>								</div>');												//ligne 157 appelle de la fonction js update						//ligne 165 appelle de la fonction affiche a l'affichage de la page											}		public function gerer_tarifs()		{			$connect = $this->_bdd->openBDD();			mysqli_set_charset($connect,"utf8");			$reponse = $connect->query('SELECT * FROM tarifs_revision UNION SELECT * FROM tarifs_reparation UNION SELECT * FROM tarifs_articles');			$affichage="";			$i = 0;						$nbTarifRevision = "";			$nbTarifReparation = "";			$nbTarifArticle = "";						$compteur = $connect->query('SELECT * FROM tarifs_revision');			while($donnees = $compteur->fetch_array())			{				$nbTarifRevision++;			}						$compteur = $connect->query('SELECT * FROM tarifs_reparation');			while($donnees = $compteur->fetch_array())			{				$nbTarifReparation++;			}						$compteur = $connect->query('SELECT * FROM tarifs_articles');			while($donnees = $compteur->fetch_array())			{				$nbTarifArticle++;			}						while($donnees = $reponse->fetch_array())			{				$TVA = $donnees['tarifht']+20*$donnees['tarifht']/100;				$TVA = number_format($TVA, 2, '.', '');				if($i==0){					$contenuRevision = '<div class="demo-card-wide mdl-card mdl-shadow--2dp">									<div class="mdl-card__supporting-text card-background" style="width:99%;">								 <div class="tableau">								 <form action="index.php?d=administrateur&a=modification_tarif" method="post">									<table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp" style="margin:auto; width:70%;">										<tr><th colspan="5" style="text-align:left; font-size:18px;">Tarifs atelier lors d\'une révision</th></tr>										<tr>											<th></th>											<th style="text-align:left; font-size:18px;">Tarif HT €</th>											<th style="text-align:left; font-size:18px;">Tarif TTC €</th>											<th style="text-align:left; font-size:18px;">%Pro</th>											<th></th>										</tr>										<tr ng-app="">											<td align="left" style="text-align:left; font-size:16px" class="mdl-cell mdl-cell--4-col">'.$donnees['nom'].' :</td>											<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">												<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">													<input name="tarifHT'.$i.'" class="mdl-textfield__input" type="text" value="'.$donnees['tarifht'].'" style="text-align:right; width:50%;">													<label class="mdl-textfield__label" for="sample3" id="'.$i.'" style="width:50%;"></label>												</div>											</td>											<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">												<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">													<input name="tarifTTC'.$i.'" class="mdl-textfield__input" type="text" value="'.$TVA.'" style="text-align:right; width:50%;" readonly	>													<label class="mdl-textfield__label" for="sample3" id="'.$i.'" style="width:50%;"></label>												</div>											</td>											<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">												<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">													<input name="tarifPCT'.$i.'" class="mdl-textfield__input" type="text" value="'.$donnees['pourcent'].'" style="text-align:right; width:50%;">													<label class="mdl-textfield__label" for="sample3" id="'.$i.'" style="width:50%;"></label>												</div>											</td>											<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">												<button style="color: #F44336;" type="submit" name="btnRevision" id="'.$donnees['id'].'" class="mdl-button mdl-button--accent mdl-js-button mdl-js-ripple-effect"/>													Supprimer												</button>											</td>										</tr>';				}				else{					$contenuRevision = '<tr>									<td align="left" style="text-align:left; font-size:16px" class="mdl-cell mdl-cell--4-col">'.$donnees['nom'].' :</td>									<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">										<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">											<input name="tarifHT'.$i.'" class="mdl-textfield__input" type="text" value="'.$donnees['tarifht'].'" style="text-align:right; width:50%;">											<label class="mdl-textfield__label" for="sample3" id="'.$i.'" style="width:50%;"></label>										</div>									</td>									<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">										<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">											<input name="tarifTTC'.$i.'" class="mdl-textfield__input" type="text" value="'.$TVA.'" style="text-align:right; width:50%;" readonly>											<label class="mdl-textfield__label" for="sample3" id="'.$i.'" style="width:50%;"></label>										</div>									</td>									<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">										<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">											<input name="tarifPCT'.$i.'" class="mdl-textfield__input" type="text" value="'.$donnees['pourcent'].'" style="text-align:right; width:50%;">											<label class="mdl-textfield__label" for="sample3" id="'.$i.'" style="width:50%;"></label>										</div>									</td>									<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">										<button style="color: #F44336;" type="submit" name="btnRevision" value="'.$donnees['id'].'" class="mdl-button mdl-button--accent mdl-js-button mdl-js-ripple-effect"/>											Supprimer										</button>									</td>								</tr>';														}				$contenuReparation = '<tr>											<td align="left" style="text-align:left; font-size:16px" class="mdl-cell mdl-cell--4-col">'.$donnees['nom'].' :</td>											<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">												<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">													<input name="tarifHT'.$i.'" class="mdl-textfield__input" type="text" value="'.$donnees['tarifht'].'" style="text-align:right; width:50%;">													<label class="mdl-textfield__label" for="sample3" id="'.$i.'" style="width:50%;"></label>												</div>											</td>											<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">												<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">													<input name="tarifTTC'.$i.'" class="mdl-textfield__input" type="text" value="'.$TVA.'" style="text-align:right; width:50%;" readonly>													<label class="mdl-textfield__label" for="sample3" id="'.$i.'" style="width:50%;"></label>												</div>											</td>											<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">												<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">													<input name="tarifPCT'.$i.'" class="mdl-textfield__input" type="text" value="'.$donnees['pourcent'].'" style="text-align:right; width:50%;">													<label class="mdl-textfield__label" for="sample3" id="'.$i.'" style="width:50%;"></label>												</div>											</td>											<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">												<button style="color: #F44336;" type="submit" name="btnReparation" value="'.$donnees['id'].'" class="mdl-button mdl-button--accent mdl-js-button mdl-js-ripple-effect"/>													Supprimer												</button>											</td>										</tr>';								$contenuArticles = '<tr>											<td align="left" style="text-align:left; font-size:16px" class="mdl-cell mdl-cell--4-col">'.$donnees['nom'].' :</td>											<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">												<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">													<input name="tarifHT'.$i.'" class="mdl-textfield__input" type="text" value="'.$donnees['tarifht'].'" style="text-align:right; width:50%;">													<label class="mdl-textfield__label" for="sample3" id="'.$i.'" style="width:50%;"></label>												</div>											</td>											<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">												<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">													<input name="tarifTTC'.$i.'" class="mdl-textfield__input" type="text" value="'.$TVA.'" style="text-align:right; width:50%;" readonly>													<label class="mdl-textfield__label" for="sample3" id="'.$i.'" style="width:50%;"></label>												</div>											</td>											<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">												<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">													<input name="tarifPCT'.$i.'" class="mdl-textfield__input" type="text" value="'.$donnees['pourcent'].'" style="text-align:right; width:50%;">													<label class="mdl-textfield__label" for="sample3" id="'.$i.'" style="width:50%;"></label>												</div>											</td>											<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">												<button style="color: #F44336;" type="submit" name="btnArticle" value="'.$donnees['id'].'" class="mdl-button mdl-button--accent mdl-js-button mdl-js-ripple-effect"/>													Supprimer												</button>											</td>										</tr>';								if($i==$nbTarifRevision)				{					$affichage=$affichage.'</table></br><div class="tableau">														<table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp" style="margin:auto; width:70%;">															<tr><th colspan="5" style="text-align:left; font-size:18px;">Tarifs atelier lors d\'une réparation</th></tr>															<tr>																<th></th>																<th style="text-align:left; font-size:18px;">Tarif HT €</th>																<th style="text-align:left; font-size:18px;">Tarif TTC €</th>																<th style="text-align:left; font-size:18px;">%Pro</th>																<th></th>															</tr>															<tr>																<td align="left" style="text-align:left; font-size:16px" class="mdl-cell mdl-cell--4-col">'.$donnees['nom'].' :</td>																<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">																	<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">																		<input name="tarifHT'.$i.'" class="mdl-textfield__input" type="text" value="'.$donnees['tarifht'].'" style="text-align:right; width:50%;">																		<label class="mdl-textfield__label" for="sample3" id="'.$i.'" style="width:50%;"></label>																	</div>																</td>																<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">																	<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">																		<input name="tarifTTC'.$i.'" class="mdl-textfield__input" type="text" value="'.$TVA.'" style="text-align:right; width:50%;" readonly>																		<label class="mdl-textfield__label" for="sample3" id="'.$i.'" style="width:50%;"></label>																	</div>																</td>																<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">																	<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">																		<input name="tarifPCT'.$i.'" class="mdl-textfield__input" type="text" value="'.$donnees['pourcent'].'" style="text-align:right; width:50%;">																		<label class="mdl-textfield__label" for="sample3" id="'.$i.'" style="width:50%;"></label>																	</div>																</td>																<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">																	<button style="color: #F44336;" type="submit" name="btnReparation" value="'.$donnees['id'].'" class="mdl-button mdl-button--accent mdl-js-button mdl-js-ripple-effect"/>																		Supprimer																	</button>																</td>															</tr>';					;				}				elseif($i>=$nbTarifRevision && $i<$nbTarifRevision+$nbTarifReparation)				{					$affichage=$affichage.$contenuReparation;				}				elseif($i==$nbTarifRevision+$nbTarifReparation)				{					$affichage=$affichage.'</table></br></br><div class="tableau">														<table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp" style="margin:auto; width:70%;">															<tr><th colspan="5" style="text-align:left; font-size:18px;">Tarifs articles</th></tr>															<tr>																<th></th>																<th style="text-align:left; font-size:18px;">Tarif HT €</th>																<th style="text-align:left; font-size:18px;">Tarif TTC €</th>																<th style="text-align:left; font-size:18px;">%Pro</th>																<th></th>														</tr>														<tr>															<td align="left" style="text-align:left; font-size:16px" class="mdl-cell mdl-cell--4-col">'.$donnees['nom'].' :</td>															<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">																<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">																	<input name="tarifHT'.$i.'" class="mdl-textfield__input" type="text" value="'.$donnees['tarifht'].'" style="text-align:right; width:50%;">																	<label class="mdl-textfield__label" for="sample3" id="'.$i.'" style="width:50%;"></label>																</div>															</td>															<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">																<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">																	<input name="tarifTTC'.$i.'" class="mdl-textfield__input" type="text" value="'.$TVA.'" style="text-align:right; width:50%;" readonly>																	<label class="mdl-textfield__label" for="sample3" id="'.$i.'" style="width:50%;"></label>																</div>															</td>															<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">																<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">																	<input name="tarifPCT'.$i.'" class="mdl-textfield__input" type="text" value="'.$donnees['pourcent'].'" style="text-align:right; width:50%;">																	<label class="mdl-textfield__label" for="sample3" id="'.$i.'" style="width:50%;"></label>																</div>															</td>															<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">																<button style="color: #F44336;" type="submit" name="btnArticle" value="'.$donnees['id'].'" class="mdl-button mdl-button--accent mdl-js-button mdl-js-ripple-effect"/>																	Supprimer																</button>															</td>														</tr>';				}				elseif($i>=$nbTarifRevision+$nbTarifReparation)				{					$affichage=$affichage.$contenuArticles;				}				else				{					$affichage=$affichage.$contenuRevision;				}								$i++;			}			$affichage = $affichage.'</table></br>									<button type="submit" name="btnValider" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect mdl-button--fab fixedButton fixedButtonValidate" style="position:fixed; top:15%; left:13%; height:56px;">										<i class="material-icons">edit</i>										<span></span>									</button>								</form>						</div></div></div>							<a href="#popup_addTarif">								<button class="mdl-button mdl-js-button mdl-button--fab mdl-button--colored fixedButton" style="position:fixed; top:8%; left:13%; height:56px;">									<i class="material-icons">add</i>									<span></span>								</button>							</a>							<div id="popup_addTarif" class="overlay">								<div class="popup" style="width:60%;">									<h2>Ajouter un tarif</h2>									<a class="close" href="#">&times;</a>									<div id="tarif">										<p>Type de tarif à ajouter :</p>									<form action="index.php?d=administrateur&a=ajout_tarif" method="post">										<select id="typeTarif" class="nice-select" name="typeTarif">											<option value="0">Révision</option>											<option value="1">Réparation</option>											<option value="2">Article</option>										</select>									</div>														<div id="tabAdd">										<table class="mdl-data-table mdl-js-data-table mdl-shadow--2dp">											<tr>												<th style="text-align:left; font-size:18px;">Nom</th>												<th style="text-align:center; font-size:18px;">Tarif HT €</th>												<th style="text-align:center; font-size:18px;">Tarif TTC €</th>												<th style="text-align:center; font-size:18px;">%Pro</th>											</tr>											<td align="left" valign="top" class="mdl-cell mdl-cell--6-col" style="text-align:left;">												<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">													<input name="tarifName" class="mdl-textfield__input" type="text" value="" style="text-align:right; width:200px;">													<label class="mdl-textfield__label" for="sample3" id="" style="width:200px;"></label>												</div>											</td>											<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">												<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">													<input name="tarifHT" class="mdl-textfield__input" type="text" value="" style="text-align:right; width:50%;">													<label class="mdl-textfield__label" for="sample3" id="" style="width:50%;"></label>												</div>											</td>											<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">												<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">													<input name="tarifTTC" class="mdl-textfield__input" type="text" value="" style="text-align:right; width:50%;" readonly>													<label class="mdl-textfield__label" for="sample3" id="" style="width:50%;"></label>												</div>											</td>											<td align="center" valign="top" class="mdl-cell mdl-cell--2-col">												<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label" style="width:150px;">													<input name="tarifPCT" class="mdl-textfield__input" type="text" value="" style="text-align:right; width:50%;">													<label class="mdl-textfield__label" for="sample3" id="" style="width:50%;"></label>												</div>											</td>										</table>									</div>									<br />									<center>										<button type="submit" class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect">											Ajouter le tarif										</button>										</form>									</center>									<br />								</div>							</div>';			return($affichage);			$this->_bdd->CloseBDD();		}		public function ValidationVoileConstructeur()		{			$select="<option value=-2>rien</option>";			$connectionBDD=$this->_bdd->openBDD();			$sql="SELECT * FROM voile WHERE valider=0";			$result=$connectionBDD->query($sql);			while($row = mysqli_fetch_array($result))			{				$select = $select."<option value=$row[0]>$row[1]</option>";		// ajout de tous les clients avec $row[0]=id et $row[1] leur email			}			return('								<div class="demo-card-wide mdl-card mdl-shadow--2dp">									<div class="mdl-card__title mdl-card-administration__background animated slideInDown">				<h2 class="mdl-card__title-text">valisation de voile </h2>				</div>				<div class="voile-select">					<select id="voile" class="nice-select" name="voile" >					'.$select.'					</select>				</div>				<div classe="valeur-voile">					<div class="content-grid mdl-grid">						<div class="mdl-cell">											</div>						<div class="mdl-cell">						</div>						<div class="mdl-cell">						</div>					</div>				</div>																												');		}				public function validationNouveauClient()		{						function generationMotDePasse($taille = 10) {				$chaine = '0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ';				$chaineTaille = strlen($chaine);				$motDePasse = '';				for ($i = 0; $i < $taille; $i++) {					$motDePasse .= $chaine[rand(0, $chaineTaille - 1)];				}				return $motDePasse;			}						// connexion à la base de données			$bdd =  $this->_bdd->openBDD();						$email = ($_POST['email']);			$query = $bdd->query("SELECT email FROM clients WHERE email='$email'");			$num_row = $query->num_rows;			if ($num_row >= 1)			{				// Si l'email est déjà utilisée on retourne un code d'erreur				echo "<script>alert('L\'adresse email est déjà utilisée. Veuillez la modifier afin de procéder à la création du compte.'); location.href = 'index.php?d=administrateur&a=gerer_utilisateurs';</script>";			}			else			{				if(ctype_digit($_POST['telephone']) == true && (ctype_digit($_POST['code_postal'])) == true)				{					// RECUPERATION des données de la base de données					$password = generationMotDePasse();					$password_crypt = sha1($password);					$nom = $_POST['nom'];					$prenom = $_POST['prenom'];					$telephone = $_POST['telephone'];					$ville = $_POST['ville'];					$code_postal = $_POST['code_postal'];					$adresse = $_POST['adresse'];										if(isset($_POST['permissions']))					{						if ($_POST['permissions'] == 1)						{							$permissions = 2;						}						else						{							$permissions = 1;						}					}					else 					{						$permissions = 1;					}										// ajout à la base de données des clients					$bdd->query("INSERT INTO clients VALUES('','$email','$password_crypt','$nom','$prenom', '$telephone', '$ville','$adresse','$code_postal','$ville','$adresse','$code_postal','default','$permissions','1')");										if($permissions == 1)					{						$typeCompte = "client";					}					else					{						$typeCompte = "opérateur";					}										// Préparation du mail de récapitulatif					$to      = $email;					$subject = 'Création de votre compte '.$typeCompte.' Ailipse Technique';					$message = 'Bienvenue chez <strong>Ailipse Technique</strong>. <br/><br/> Voici un récapitulatif des informations de votre compte : <br/><br/> <strong>Identifiant</strong> : '.$email.'<br/> <strong>Mot de passe provisoire</strong> : '.$password.'<br/><br/> <strong>Nom</strong> : '.$nom.' <br/> <strong>Prénom</strong> : '.$prenom.' <br/> <strong>Téléphone</strong> : '.$telephone.' <br/><br/> <strong>Adresse d\'expédition</strong> : '.$adresse.' <br/> <strong>Code postal d\'expédition</strong> : '.$code_postal.' <br/> <strong>Ville d\'expédition</strong> : '.$ville.' <br/><br/> <strong>Adresse de facturation</strong> : '.$adresse.' <br/> <strong>Code postal de facturation</strong> : '.$code_postal.' <br/> <strong>Ville de facturation</strong> : '.$ville.' <br/><br/> Pour une raison de sécurité, vous êtes invité à changer votre mot de passe dès votre première connexion via notre site internet. <br/><br/> Cet email est un message automatique, merci de ne pas y répondre. <br/><br/> <center><img src="http://www.ailipse-technique.fr/selAT/public/img/ailipse_logoweb.png"></img></center>';					$headers = "MIME-Version: 1.0" . "\r\n";					$headers .= "Content-type:text/html;charset=UTF-8" . "\r\n";					mail($to, $subject, $message, $headers);										echo "<script>alert('Compte créé avec succès.'); location.href = 'index.php?d=administrateur&a=gerer_utilisateurs';</script>";				}				else				{					// Si les champs code postal et téléphone ne sont pas des saisies numériques					echo "<script>alert('Les champs téléphone et/ou code postal ne sont pas au format numérique.'); location.href = 'index.php?d=administrateur&a=gerer_utilisateurs#ajout_client';</script>";				}			}			$this->CloseBDD($bdd);// fermeture de la base de données 		}				public function gestionUtilisateursRecup()		{						// Connexion à la base de données			$connect = $this->_bdd->openBDD();						$id=$_POST["id"];						$query = "SELECT * FROM clients WHERE id='".$id."'";						$result = $connect->query($query);						if ($result->num_rows > 0)						{								// output data of each row								while($row = $result->fetch_assoc())								{										$client_email= $row["email"];										$client_nom = $row["nom"];										$client_prenom = $row["prenom"];										$client_telephone = $row["telephone"];										$client_rue_expedition = $row["rue_expedition"];										$client_ville_expedition = $row["ville_expedition"];										$client_code_postal_expedition = $row["code_postal_expedition"];										$client_rue_facturation = $row["rue_facturation"];										$client_ville_facturation = $row["ville_facturation"];										$client_code_postal_facturation = $row["code_postal_facturation"];										$client_permissions= $row["permissions"];										$client_actif=$row["actif"];									}							}												echo $client_email.",".										$client_rue_expedition.",".										$client_ville_expedition.",".										$client_code_postal_expedition.",".										$client_rue_facturation.",".										$client_ville_facturation.",".										$client_code_postal_facturation.",".										$client_actif.",".										$client_nom.",".										$client_prenom.",".										$client_telephone.",".										$client_permissions;														$this->_bdd->CloseBDD();					}			public function gestionUtilisateursMAJ()		{						// Connexion à la base de données						include 'connect.php';												$connect = $this->_bdd->openBDD();								$id=$_GET["id"];						$email=$_GET["email"];						$new_password=$_GET["password"];						$verification=$_GET["verification"];						$rue=$_GET["rue_exp"];						$code=$_GET["code_postal_exp"];						$ville=$_GET["ville_exp"];						$rueFac=$_GET["rue_fac"];						$codeFac=$_GET["code_postal_fac"];						$villeFac=$_GET["ville_fac"];						$prenom=$_GET["prenom"];						$nom=$_GET["nom"];						$telephone=$_GET["telephone"];						$activa = $_GET["activation"];						$operateur = $_GET["operateur"];									$result = $connect->query("SELECT * FROM clients WHERE email='$email'");			if($result->num_rows > 0)			{				while($row = $result->fetch_assoc())				{					$permissions = $row["permissions"];				}			}						// A modifier : changer le champ de la base de données pour que ce soit un bool						if($activa == "true")						{								$activation = 1;							}						if($activa =="false")						{								$activation = 0;							}									if ($permissions != 3)			{				if ($operateur == "true")				{					$operateur = 2;				}								if ($operateur == "false")				{					$operateur = 1;				}			}			else			{				$operateur = 3;			}									if(($new_password==$verification)&&($new_password!=""))						{								$new_password=sha1($verification);								$sql="UPDATE clients SET  email='$email' ,								password='$new_password' ,								ville_expedition='$ville' ,								rue_expedition='$rue',								code_postal_expedition='$code' ,								ville_facturation='$villeFac' ,								rue_facturation='$rueFac',								code_postal_facturation='$codeFac',								actif='$activation' ,								permissions ='$operateur',								telephone='$telephone',								nom='$nom',								prenom='$prenom'								WHERE  id='$id'";							}						else			{				$sql="UPDATE clients SET email='$email',								ville_expedition='$ville' ,								rue_expedition='$rue',								code_postal_expedition='$code' ,								ville_facturation='$villeFac' ,								rue_facturation='$rueFac',								code_postal_facturation='$codeFac',								actif='$activation' ,								permissions ='$operateur',								telephone='$telephone',								nom='$nom',								prenom='$prenom'								WHERE id='$id' ";			}						$connect->query($sql);												$this->_bdd->CloseBDD();		}				public function supprimer()		{						// Connexion à la base de données			$connect = $this->_bdd->openBDD();						// Initialisation de la variable id récupérant le client			$id=$_POST["client"];									// Requête permettant de supprimer un client en fonction de son id			$sql="DELETE FROM clients WHERE id='".$id."'";						$connect->query($sql);						$this->_bdd->CloseBDD();						// Redirection vers la page de gestion des utilisateurs			header("location: index.php?d=administrateur&a=gerer_utilisateurs");					}				public function activer()		{												$connect = $this->_bdd->openBDD();						// Initialisation des id et de la cible de l'activation (compte, annonce...)			$id=$_GET["ids"];			$target=$_GET["target"];						$array=explode(";",$id);	// enleve les ; en transformant le string en tableau			echo $target;			echo $id;			for($i=0;$i<(count($array)-1);$i++)						{												if ($target == activateUser)				{					$sql="UPDATE clients SET actif=1 WHERE id='$array[$i]'";					$connect->query($sql);// met actif tout les clien avec leur id recuper					$sql="UPDATE notifications SET comptes = comptes-1 WHERE id = 1";					$connect->query($sql);	// met a jour la basse de donner du site					$sql="SELECT email FROM clients WHERE id='$array[$i]'";					$result = $connect->query($sql);					while($row = $result->fetch_array())					{						$email = $row[0];					}					// On envoie un email à l'utilisateur pour informer que son compte est devenu actif					$to      = $email;					$subject = 'Validation de votre compte client Ailipse Technique';					$message = 'Félicitations, votre compte client <strong>Ailipse Technique</strong> vient d\'être validé par un administrateur. <br/><br/> Vous pouvez dès à présent vous connecter à l\'aide de vos identifiants précédemment rentrés lors de votre inscription. <br/><br/> Cet email est un message automatique, merci de ne pas y répondre. <br/><br/> <center><img src="http://www.ailipse-technique.fr/selAT/public/img/ailipse_logoweb.png"></img></center>';										$headers = "MIME-Version: 1.0" . "\r\n";					$headers .= "Content-type:text/html;charset=UTF-8" . "\r\n";										mail($to, $subject, $message, $headers);				}				else if ($target == activateAnnonce)				{					$sql="UPDATE annonces SET active=1 WHERE id='$array[$i]'";					$connect->query($sql);// met actif tout les clien avec leur id recuper					$sql="UPDATE notifications SET annonces = annonces-1 WHERE id = 1";					$connect->query($sql);	// met a jour la basse de donner du site					$sql="SELECT email,titre,date_publication FROM annonces WHERE id = '$array[$i]'";					$result = $connect->query($sql);					while($row = $result->fetch_array())					{						$email = $row[0];						$titre = $row[1];						$message = "Votre annonce créée le ".$row[2].", portant le nom \'".$titre."\' a été validée par un administrateur.";											}					$sql="INSERT INTO notifications_utilisateur VALUES ('','$email','$message',1)";					// On envoie un email à l'utilisateur pour informer que son annonce est devenue active					$to      = $email;					$subject = 'Validation de votre annonce '.$titre;					$message = 'Félicitations, votre annonce <strong>'.$titre.'</strong> vient d\'être validée par un administrateur. <br/><br/> Elle est à présent visible sur l\'application <strong>Ailipse Technique</strong>. <br/><br/> Cet email est un message automatique, merci de ne pas y répondre. <br/><br/> <center><img src="http://www.ailipse-technique.fr/selAT/public/img/ailipse_logoweb.png"></img></center>';										$headers = "MIME-Version: 1.0" . "\r\n";					$headers .= "Content-type:text/html;charset=UTF-8" . "\r\n";										mail($to, $subject, $message, $headers);					$connect->query($sql);	// met a jour la basse de donner du site									}							}						$this->_bdd->CloseBDD(); // fermeture					}				public function selectComptesNonActifs()		{			$connect = $this->_bdd->openBDD();									$sql="SELECT id FROM clients WHERE actif = 0";												$result = $connect->query($sql);	// selectionne tous les utilisateurs non actifs												$send="";						while($row = mysqli_fetch_array($result))						{								echo $row[0].","; // renvoi tous les id des clients non actifs							}												$this->_bdd->CloseBDD();		}				public function modificationTarif()		{			if(isset($_POST['btnRevision']))			{				$connect = $this->_bdd->openBDD();				$typetarif = "tarifs_revision";				$connect->query('DELETE FROM tarifs_revision WHERE id='.$_POST['btnRevision']);			}						elseif(isset($_POST['btnReparation']))			{				$connect = $this->_bdd->openBDD();				$typetarif = "tarifs_reparation";				$connect->query('DELETE FROM tarifs_reparation WHERE id='.$_POST['btnReparation']);			}						elseif(isset($_POST['btnArticle']))			{				$connect = $this->_bdd->openBDD();				$typetarif = "tarifs_articles";				$connect->query('DELETE FROM tarifs_articles WHERE id='.$_POST['btnArticle']);			}						elseif(isset($_POST['btnValider']))			{				$connect = $this->_bdd->openBDD();								$result = $connect->query('SELECT * FROM tarifs_revision UNION SELECT * FROM tarifs_reparation UNION SELECT * FROM tarifs_articles');								$i = 0;								while($donnees = $result->fetch_array())				{					$nom[$i]=$donnees['nom'];					$i++;				}								for($j = 0; $j < $i; $j++)				{					$valeurHT[$j] = $_POST['tarifHT'.$j];										$valeurTTC[$j] = $_POST['tarifTTC'.$j];															$valeurPCT[$j] = $_POST['tarifPCT'.$j];															$TVA = $valeurHT[$j]+20*$valeurHT[$j]/100;					$valeurTTC[$j] = number_format($TVA, 2, '.', '');				}																$nbTarifRevision=0;								$nbTarifReparation=0;								$nbTarifArticle=0;																$result = $connect->query('SELECT * FROM tarifs_revision');								while($donnees = $result->fetch_array())								{										$nbTarifRevision++;									}																$result = $connect->query('SELECT * FROM tarifs_reparation');								while($donnees = $result->fetch_array())								{										$nbTarifReparation++;									}																$result = $connect->query('SELECT * FROM tarifs_articles');								while($donnees = $result->fetch_array())								{										$nbTarifArticle++;									}								for($j = 0; $j < $i; $j++)								{										if($j<$nbTarifRevision)										{												$sql = "UPDATE tarifs_revision SET tarifht = '$valeurHT[$j]', tarifttc = '$valeurTTC[$j]', pourcent = '$valeurPCT[$j]' WHERE nom = '$nom[$j]'";											}										elseif($j<$nbTarifReparation+$nbTarifRevision)										{												$sql = "UPDATE tarifs_reparation SET tarifht = '$valeurHT[$j]', tarifttc = '$valeurTTC[$j]', pourcent = '$valeurPCT[$j]' WHERE nom = '$nom[$j]'";											}										elseif($j<$nbTarifArticle+$nbTarifReparation+$nbTarifRevision)										{												$sql = "UPDATE tarifs_articles SET tarifht = '$valeurHT[$j]', tarifttc = '$valeurTTC[$j]', pourcent = '$valeurPCT[$j]' WHERE nom = '$nom[$j]'";											}										$connect->query($sql);									}			}									$this->_bdd->CloseBDD();						header("location: index.php?d=administrateur&a=tarifs");		}				public function ajoutTarif()		{			$connect = $this->_bdd->openBDD();						$typetarif = $_POST['typeTarif'];						$nom = $_POST['tarifName'];						$valeurHT = $_POST['tarifHT'];			$valeurTTC = $_POST['tarifTTC'];						$valeurPCT = $_POST['tarifPCT'];						$TVA = $valeurHT+20*$valeurHT/100;			$valeurTTC = number_format($TVA, 2, '.', '');						if($typetarif == 0)			{				$typetarif = "tarifs_revision";				$sql = "INSERT INTO tarifs_revision VALUES ('','$nom','$valeurHT','$valeurTTC','$valeurPCT')";			}			elseif($typetarif == 1)			{				$typetarif = "tarifs_reparation";				$sql = "INSERT INTO tarifs_reparation VALUES ('','$nom','$valeurHT','$valeurTTC','$valeurPCT')";			}			elseif($typetarif == 2)			{				$typetarif = "tarifs_articles";				$sql = "INSERT INTO tarifs_articles VALUES ('','$nom','$valeurHT','$valeurTTC','$valeurPCT')";			}						$connect->query($sql);			$this->_bdd->CloseBDD();									/*//Ecriture du tarif ajouté dans le fichier logfile.txt			$contenu = date('Y-m-d h:i:s').' --- Ajout dans la table "'.$typetarif.'" de '.$_POST['tarifName'].' à '.$_POST['tarifHT'].' '.$valeurTTC.'€ '.$_POST['tarifPCT'].' par "'.$login_session.'"'."\r\n";			//Ouverture du répertoire de destination			$fichier = fopen ("../modelisation/logs/".$logfile, "a+");			//Copie du fichier			fwrite($fichier, $contenu);			//Fermeture du fichier			fclose ($fichier);			//Fin écriture*/									header("location: index.php?d=administrateur&a=tarifs");		}	}}?>